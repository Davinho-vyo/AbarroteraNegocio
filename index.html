<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="theme-color" content="#2563eb">
    <title>Mi Tiendita</title>
    
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.22.5/babel.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            margin: 0;
            padding: 0;
        }
        
        /* CRITICAL: Fix para teclado Android */
        input, textarea {
            font-size: 16px !important;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        
        /* Prevenir comportamientos que cierran el teclado */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 40;
        }
        
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            z-index: 50;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Estilos b√°sicos */
        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        .card {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-4 { margin-bottom: 16px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-2 { margin-bottom: 8px; }
        .p-4 { padding: 16px; }
        .p-3 { padding: 12px; }
        
        .navbar {
            background: #2563eb;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 12px;
        }
        
        .content {
            padding-bottom: 80px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="text-align: center; padding: 50px;">Cargando Mi Tiendita...</div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Sistema de almacenamiento simple
        const Storage = {
            save: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Error guardando:', e);
                    return false;
                }
            },
            load: (key, defaultValue = null) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (e) {
                    console.error('Error cargando:', e);
                    return defaultValue;
                }
            }
        };

        function App() {
            // Estados principales
            const [view, setView] = useState('main');
            const [showModal, setShowModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            
            // Datos
            const [inventory, setInventory] = useState(() => 
                Storage.load('inventory', [
                    { id: 1, name: 'Coca-Cola 600ml', stock: 24, cost: 12, price: 18, expiry: '2025-08-15' },
                    { id: 2, name: 'Sabritas Original', stock: 15, cost: 8, price: 15, expiry: '2025-07-20' },
                    { id: 3, name: 'Pan Bimbo Grande', stock: 8, cost: 25, price: 35, expiry: '2025-06-25' },
                    { id: 4, name: 'Leche Lala 1L', stock: 12, cost: 18, price: 25, expiry: '2025-06-20' },
                    { id: 5, name: 'Huevos San Juan', stock: 30, cost: 35, price: 50, expiry: '2025-07-01' }
                ])
            );
            
            const [sales, setSales] = useState(() => {
                const today = new Date().toDateString();
                return Storage.load(`sales_${today}`, []);
            });
            
            // Estados para formularios - NO usar objetos para evitar re-renders
            const [productName, setProductName] = useState('');
            const [productStock, setProductStock] = useState('');
            const [productCost, setProductCost] = useState('');
            const [productPrice, setProductPrice] = useState('');
            const [productExpiry, setProductExpiry] = useState('');
            
            const [saleProductId, setSaleProductId] = useState('');
            const [saleQuantity, setSaleQuantity] = useState(1);
            
            const [calcCost, setCalcCost] = useState('');
            const [calcPrice, setCalcPrice] = useState('');
            const [calcQty, setCalcQty] = useState('1');

            // Guardar inventario cuando cambie
            useEffect(() => {
                Storage.save('inventory', inventory);
            }, [inventory]);

            // Guardar ventas cuando cambien
            useEffect(() => {
                const today = new Date().toDateString();
                Storage.save(`sales_${today}`, sales);
            }, [sales]);

            // Limpiar ventas a medianoche
            useEffect(() => {
                const checkMidnight = setInterval(() => {
                    const now = new Date();
                    if (now.getHours() === 0 && now.getMinutes() === 0) {
                        setSales([]);
                    }
                }, 60000);
                
                return () => clearInterval(checkMidnight);
            }, []);

            // Calcular resumen
            const summary = {
                totalSales: sales.reduce((sum, s) => sum + s.total, 0),
                totalProfit: sales.reduce((sum, s) => sum + (s.total - (s.cost * s.quantity)), 0),
                totalProducts: sales.reduce((sum, s) => sum + s.quantity, 0)
            };

            // Funciones
            const registerSale = () => {
                if (!saleProductId) {
                    alert('Selecciona un producto');
                    return;
                }
                
                const product = inventory.find(p => p.id === parseInt(saleProductId));
                if (!product) return;
                
                if (product.stock < saleQuantity) {
                    alert('Stock insuficiente');
                    return;
                }
                
                const sale = {
                    id: Date.now(),
                    productName: product.name,
                    quantity: saleQuantity,
                    price: product.price,
                    cost: product.cost,
                    total: product.price * saleQuantity,
                    time: new Date().toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' })
                };
                
                setSales([...sales, sale]);
                setInventory(inventory.map(p => 
                    p.id === product.id 
                        ? { ...p, stock: p.stock - saleQuantity }
                        : p
                ));
                
                setSaleProductId('');
                setSaleQuantity(1);
                alert('Venta registrada');
            };

            const saveProduct = () => {
                if (!productName || !productStock || !productCost || !productPrice || !productExpiry) {
                    alert('Completa todos los campos');
                    return;
                }

                const product = {
                    id: editingProduct ? editingProduct.id : Date.now(),
                    name: productName,
                    stock: parseInt(productStock),
                    cost: parseFloat(productCost),
                    price: parseFloat(productPrice),
                    expiry: productExpiry
                };

                if (editingProduct) {
                    setInventory(inventory.map(p => p.id === product.id ? product : p));
                } else {
                    if (inventory.length >= 33) {
                        alert('M√°ximo 33 productos');
                        return;
                    }
                    setInventory([...inventory, product]);
                }
                
                // Limpiar formulario
                setProductName('');
                setProductStock('');
                setProductCost('');
                setProductPrice('');
                setProductExpiry('');
                setEditingProduct(null);
                setShowModal(false);
            };

            const editProduct = (product) => {
                setEditingProduct(product);
                setProductName(product.name);
                setProductStock(product.stock.toString());
                setProductCost(product.cost.toString());
                setProductPrice(product.price.toString());
                setProductExpiry(product.expiry);
                setShowModal(true);
            };

            const deleteProduct = (id) => {
                if (confirm('¬øEliminar producto?')) {
                    setInventory(inventory.filter(p => p.id !== id));
                }
            };

            // Calculadora
            const calcMargin = () => {
                const cost = parseFloat(calcCost) || 0;
                const price = parseFloat(calcPrice) || 0;
                const qty = parseInt(calcQty) || 1;
                
                if (cost > 0 && price > 0) {
                    const margin = ((price - cost) / cost) * 100;
                    const profit = (price - cost) * qty;
                    return { margin, profit };
                }
                return { margin: 0, profit: 0 };
            };

            const calc = calcMargin();

            // Vistas
            const MainView = () => (
                <div className="p-4">
                    <div className="card text-center mb-4">
                        <h1 style={{fontSize: '24px', fontWeight: 'bold', margin: '0 0 8px 0'}}>
                            ¬°Bienvenido Emprendedor!
                        </h1>
                        <p style={{color: '#6b7280', margin: 0}}>
                            Que tengas un excelente d√≠a de ventas, no te rindas
                        </p>
                    </div>
                    
                    <div className="grid-2 mb-4">
                        <button 
                            onClick={() => setView('sales')}
                            className="btn btn-success"
                            style={{display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '20px'}}
                        >
                            <span style={{fontSize: '32px'}}>üí∞</span>
                            <span>Registrar Venta</span>
                        </button>
                        
                        <button 
                            onClick={() => setView('inventory')}
                            className="btn btn-primary"
                            style={{display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '20px'}}
                        >
                            <span style={{fontSize: '32px'}}>üì¶</span>
                            <span>Ver Inventario</span>
                        </button>
                    </div>
                    
                    <div className="card mb-4">
                        <h2 style={{fontSize: '18px', fontWeight: 'bold', marginBottom: '12px'}}>
                            üìä Resumen del D√≠a
                        </h2>
                        <div style={{fontSize: '14px'}}>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '4px'}}>
                                <span>Ventas:</span>
                                <strong>${summary.totalSales.toFixed(2)}</strong>
                            </div>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '4px'}}>
                                <span>Ganancias:</span>
                                <strong style={{color: '#10b981'}}>${summary.totalProfit.toFixed(2)}</strong>
                            </div>
                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                <span>Productos:</span>
                                <strong>{summary.totalProducts}</strong>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <h2 style={{fontSize: '18px', fontWeight: 'bold', marginBottom: '12px'}}>
                            üßÆ Calculadora
                        </h2>
                        <div className="grid-2 mb-2" style={{gridTemplateColumns: '1fr 1fr 1fr'}}>
                            <input 
                                type="text"
                                inputMode="decimal"
                                placeholder="Costo"
                                value={calcCost}
                                onChange={(e) => setCalcCost(e.target.value)}
                                style={{padding: '8px', border: '1px solid #d1d5db', borderRadius: '6px'}}
                            />
                            <input 
                                type="text"
                                inputMode="decimal"
                                placeholder="Precio"
                                value={calcPrice}
                                onChange={(e) => setCalcPrice(e.target.value)}
                                style={{padding: '8px', border: '1px solid #d1d5db', borderRadius: '6px'}}
                            />
                            <input 
                                type="text"
                                inputMode="numeric"
                                placeholder="Cant"
                                value={calcQty}
                                onChange={(e) => setCalcQty(e.target.value)}
                                style={{padding: '8px', border: '1px solid #d1d5db', borderRadius: '6px'}}
                            />
                        </div>
                        {calc.margin > 0 && (
                            <div style={{background: 'white', padding: '8px', borderRadius: '6px', display: 'flex', justifyContent: 'space-between'}}>
                                <strong>{calc.margin.toFixed(1)}%</strong>
                                <strong style={{color: '#10b981'}}>${calc.profit.toFixed(2)}</strong>
                            </div>
                        )}
                    </div>
                </div>
            );

            const SalesView = () => {
                const availableProducts = inventory.filter(p => p.stock > 0).sort((a, b) => a.name.localeCompare(b.name));
                const selectedProduct = inventory.find(p => p.id === parseInt(saleProductId));
                const saleTotal = selectedProduct ? selectedProduct.price * saleQuantity : 0;
                
                return (
                    <div className="p-4">
                        <h1 style={{fontSize: '20px', fontWeight: 'bold', marginBottom: '16px'}}>
                            üí∞ Registrar Venta
                        </h1>
                        
                        <div className="card mb-4">
                            <label style={{display: 'block', fontWeight: 'bold', marginBottom: '8px'}}>
                                Producto:
                            </label>
                            <select 
                                value={saleProductId}
                                onChange={(e) => setSaleProductId(e.target.value)}
                                className="input-field"
                                style={{marginBottom: '16px'}}
                            >
                                <option value="">Selecciona...</option>
                                {availableProducts.map(p => (
                                    <option key={p.id} value={p.id}>
                                        {p.name} - ${p.price} ({p.stock})
                                    </option>
                                ))}
                            </select>
                            
                            <label style={{display: 'block', fontWeight: 'bold', marginBottom: '8px'}}>
                                Cantidad:
                            </label>
                            <div style={{display: 'flex', gap: '12px', alignItems: 'center', marginBottom: '16px'}}>
                                <button 
                                    onClick={() => setSaleQuantity(Math.max(1, saleQuantity - 1))}
                                    className="btn btn-danger"
                                    style={{width: '48px'}}
                                >
                                    -
                                </button>
                                <input 
                                    type="text"
                                    inputMode="numeric"
                                    value={saleQuantity}
                                    onChange={(e) => setSaleQuantity(parseInt(e.target.value) || 0)}
                                    style={{width: '80px', textAlign: 'center', padding: '8px', border: '1px solid #d1d5db', borderRadius: '6px'}}
                                />
                                <button 
                                    onClick={() => setSaleQuantity(saleQuantity + 1)}
                                    className="btn btn-success"
                                    style={{width: '48px'}}
                                >
                                    +
                                </button>
                            </div>
                            
                            <div style={{background: '#d1fae5', padding: '12px', borderRadius: '8px', marginBottom: '16px'}}>
                                <p style={{fontSize: '20px', fontWeight: 'bold', textAlign: 'center', margin: 0}}>
                                    Total: ${saleTotal.toFixed(2)}
                                </p>
                            </div>
                            
                            <button 
                                onClick={registerSale}
                                className="btn btn-success"
                                style={{width: '100%'}}
                            >
                                Registrar Venta
                            </button>
                        </div>
                        
                        <div className="card">
                            <h2 style={{fontSize: '16px', fontWeight: 'bold', marginBottom: '12px'}}>
                                Ventas de Hoy
                            </h2>
                            {sales.length === 0 ? (
                                <p style={{textAlign: 'center', color: '#6b7280'}}>Sin ventas</p>
                            ) : (
                                <div style={{maxHeight: '200px', overflowY: 'auto'}}>
                                    {sales.map(s => (
                                        <div key={s.id} style={{background: 'white', padding: '8px', borderRadius: '6px', marginBottom: '8px'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between'}}>
                                                <strong>{s.productName}</strong>
                                                <span>${s.total.toFixed(2)}</span>
                                            </div>
                                            <div style={{fontSize: '12px', color: '#6b7280'}}>
                                                {s.quantity} unidades ‚Ä¢ {s.time}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const InventoryView = () => (
                <div className="p-4">
                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                        <h1 style={{fontSize: '20px', fontWeight: 'bold'}}>
                            üì¶ Inventario
                        </h1>
                        <button 
                            onClick={() => {
                                setEditingProduct(null);
                                setProductName('');
                                setProductStock('');
                                setProductCost('');
                                setProductPrice('');
                                setProductExpiry('');
                                setShowModal(true);
                            }}
                            className="btn btn-primary"
                            style={{padding: '8px 16px'}}
                        >
                            + Nuevo
                        </button>
                    </div>
                    
                    <p style={{fontSize: '14px', color: '#6b7280', marginBottom: '12px'}}>
                        Productos: {inventory.length}/33
                    </p>
                    
                    <div style={{maxHeight: '60vh', overflowY: 'auto'}}>
                        {inventory.map(product => (
                            <div key={product.id} className="card">
                                <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '8px'}}>
                                    <strong>{product.name}</strong>
                                    <div style={{display: 'flex', gap: '8px'}}>
                                        <button 
                                            onClick={() => editProduct(product)}
                                            style={{background: 'none', border: 'none', fontSize: '18px'}}
                                        >
                                            ‚úèÔ∏è
                                        </button>
                                        <button 
                                            onClick={() => deleteProduct(product.id)}
                                            style={{background: 'none', border: 'none', fontSize: '18px'}}
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                                <div style={{fontSize: '14px', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '4px'}}>
                                    <div>Stock: {product.stock}</div>
                                    <div>Precio: ${product.price}</div>
                                    <div>Costo: ${product.cost}</div>
                                    <div>Vence: {new Date(product.expiry).toLocaleDateString('es-MX')}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {showModal && (
                        <>
                            <div className="modal-backdrop" onClick={() => setShowModal(false)} />
                            <div className="modal-content">
                                <h2 style={{fontSize: '18px', fontWeight: 'bold', marginBottom: '16px'}}>
                                    {editingProduct ? 'Editar' : 'Nuevo'} Producto
                                </h2>
                                
                                <input 
                                    type="text"
                                    placeholder="Nombre del producto"
                                    value={productName}
                                    onChange={(e) => setProductName(e.target.value)}
                                    className="input-field"
                                    autoComplete="off"
                                />
                                
                                <input 
                                    type="text"
                                    inputMode="numeric"
                                    placeholder="Cantidad en stock"
                                    value={productStock}
                                    onChange={(e) => setProductStock(e.target.value)}
                                    className="input-field"
                                />
                                
                                <input 
                                    type="text"
                                    inputMode="decimal"
                                    placeholder="Costo"
                                    value={productCost}
                                    onChange={(e) => setProductCost(e.target.value)}
                                    className="input-field"
                                />
                                
                                <input 
                                    type="text"
                                    inputMode="decimal"
                                    placeholder="Precio de venta"
                                    value={productPrice}
                                    onChange={(e) => setProductPrice(e.target.value)}
                                    className="input-field"
                                />
                                
                                <input 
                                    type="date"
                                    value={productExpiry}
                                    onChange={(e) => setProductExpiry(e.target.value)}
                                    className="input-field"
                                />
                                
                                <div className="grid-2">
                                    <button 
                                        onClick={saveProduct}
                                        className="btn btn-success"
                                    >
                                        Guardar
                                    </button>
                                    <button 
                                        onClick={() => setShowModal(false)}
                                        className="btn btn-secondary"
                                    >
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );

            return (
                <div>
                    <div className="navbar">
                        {new Date().toLocaleDateString('es-MX', { 
                            weekday: 'long', 
                            day: 'numeric', 
                            month: 'long' 
                        })}
                    </div>
                    
                    <div className="content">
                        {view === 'main' && <MainView />}
                        {view === 'sales' && <SalesView />}
                        {view === 'inventory' && <InventoryView />}
                    </div>
                    
                    {view !== 'main' && (
                        <div className="bottom-nav">
                            <button 
                                onClick={() => setView('main')}
                                className="btn btn-primary"
                                style={{width: '100%'}}
                            >
                                üè† Inicio
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
